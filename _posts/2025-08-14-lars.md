---
title: Architected a Modular Replay System (LARS) for Automated Vehicle Testing
description: "Developed and deployed a vehicle-agnostic system to enable repeatable and consistent testing of automated controllers across multiple platforms."
date: 2025-05-08
categories: [System Architecture]
tags: [controls, vehicle-testing, vehicle-integration, CANFD, software-architecture, hardware-architecture, simulink, matlab, ROS2, python, UDP, linux, networking]
pin: true
math: true
mermaid: true
image:
  path: assets/img/lars_thumbnail.jpg
  alt: The LARS system implemented on a 2024 Cadillac LYRIQ deployed at GM's Desert Proving Grounds in Yuma, AZ during the EcoCAR EV Challenge Year 3 competition in May 2025.
---

## The Challenge

Developing and testing new automated vehicle controllers is often difficult due to inconsistencies in vehicle platforms and test environments. A major hurdle is the inability to perform repeatable lead vehicle testing, which is essential for benchmarking controller performance across different vehicle types and test tracks. A modular, vehicle-agnostic solution was needed to enable standardized and consistent testing.

## The Technical Solution

As a Connected and Automated Vehicle Research Engineer at Argonne National Lab, I architected and developed the **Longitudinal Automated Replay System (LARS)**. This modular system enabled repeatable lead vehicle behavior by following a predefined speed trace with minimal tracking error. My work included:

* **System Architecture:** Designed a vehicle-agnostic system using a standardized bus architecture and the FlexIL vehicle interface, allowing any ACC controller to be integrated via a plug-and-play approach. The entire framework is designed to be flexible, enabling deployment on any vehicle and controller hardware.

![LARS System Architecture](assets/img/lars-v1-arch.jpg)
*Figure: The high-level architecture of LARS, showing the modular Flex IL Interface that enables vehicle-agnostic integration with the LYRIQ's CAN network and the comma.ai pedal interface.*

* **Deployment:** Successfully designed and deployed the system on multiple platforms, including a 2024 Cadillac Lyriq and a 2023 Toyota Prius Prime, using comma.ai override systems.
* **UI/UX:** Developed a clean user interface and a robust state machine to manage the system's control and real-time performance.

![LARS User Interface](assets/img/LARS_UI_beta.png)
*Figure: The LARS user interface, providing real-time vehicle state, pedal command, and performance data during testing.*

### Version 2 Upgrade (Python + ROS)
While LARS Version 1 proved successful, its reliance on Simulink and a proprietary vehicle interface presented challenges with flexibility and scalability. To create a more programmatically robust and modular system, I led the development of LARS Version 2, migrating the entire architecture to an open-source Robot Operating System (ROS 2) framework.

![ROS Architecture](assets/img/lars-1-pager.jpg)
*Figure: The high-level ROS-based software architecture for LARS Version 2, demonstrating the use of decoupled nodes and ROS topics to create a modular and scalable system.*

* **Modular ROS Nodes:** The system was re-architected into distinct ROS nodes for functions such as the Main Control Loop, Pedal Controller, Drivecyle Manager, and Vehicle-Specific Interface.
* **Decoupled Communication:** Inter-process communication was standardized using ROS Topics, allowing for cleaner data flow and easier integration of new components without redesigning the core system.
* **Language Flexibility:** The new architecture supports nodes written in multiple languages, such as Python and C++, for enhanced development flexibility.

This migration not only solved the inherent limitations of the original system but also positioned LARS as a more extensible and collaborative platform for future research.


## Impact & Results

The LARS system revolutionized how we conducted automated controller testing, ensuring consistency and reliability across various test scenarios and vehicle platforms.

* **Validated Performance:** LARS was successfully validated during DOE AVATAR-funded testing at General Motors' Milford Proving Grounds and Desert Proving Grounds.
* **Enabled Benchmarking:** The system enabled cross-platform controller benchmarking, a critical step in evaluating the performance of new automated driving systems.
* **Cross-Program Integration:** The framework's success has paved the way for its adoption in other projects at the lab.

![LARS Real-World Testing](assets/img/lars-testing.jpg)
*Figure: The LARS-equipped Cadillac LYRIQ and a stock LYRIQ on a test track at GM's Desert Proving Grounds, demonstrating real-world system validation.*

## Video Featuring LARS
<div style="padding:56.25% 0 0 0;position:relative;"><iframe src="https://player.vimeo.com/video/1103835725?h=b1031715fb&badge=0&autopause=0&player_id=0&app_id=58479" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share" referrerpolicy="strict-origin-when-cross-origin" style="position:absolute;top:0;left:0;width:100%;height:100%;" title="EcoCAR EVCY3 CAVs"></iframe></div><script src="https://player.vimeo.com/api/player.js"></script>